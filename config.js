const TILE_SIZE = 32;
const ROWS = 15;
const COLS = 20;

// AI 봇 성격 정의
const BOT_PERSONALITIES = {
    AGGRESSIVE: 'aggressive', // 공격형: 끈질긴 추격, 아이템 즉시 사용
    CAREFUL: 'careful',       // 신중형: 도주 우선, 쉴드 선호
    PLAYFUL: 'playful',       // 장난꾸러기: 랜덤 행동, 바나나 설치
    COWARD: 'coward'          // 겁쟁이: 사람이 보이면 무조건 도망
};

const ITEM_TYPES = ['speed', 'banana', 'shield'];

// 맵 데이터 (1: 벽, 0: 빈 공간)
const MAPS = {
    DEFAULT: [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    MAZE: [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1],
        [1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1],
        [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    OPEN: [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ]
};

// --- 좀비 모드 (임시) 맵 생성 (50x40) ---
const Z_COLS = 50;
const Z_ROWS = 40;
const tempZombieMap = [];

for (let r = 0; r < Z_ROWS; r++) {
    const row = [];
    for (let c = 0; c < Z_COLS; c++) {
        // 1. 테두리
        if (r === 0 || r === Z_ROWS - 1 || c === 0 || c === Z_COLS - 1) {
            row.push(1);
            continue;
        }

        // 2. 중앙 대로 (15~24행)
        if (r >= 15 && r <= 24) {
            if (Math.random() < 0.05 && c > 5 && c < Z_COLS - 5) row.push(1);
            else row.push(0);
            continue;
        }

        // 3. 위쪽 마을
        if (r >= 2 && r <= 12) {
            if (c % 10 >= 2 && c % 10 <= 6 && r % 8 >= 2 && r % 8 <= 6) {
                if (r % 8 === 6 && c % 10 === 4) row.push(0);
                else if (r % 8 > 2 && r % 8 < 6 && c % 10 > 2 && c % 10 < 6) row.push(0);
                else {
                    // Log potential issue if needed or just leave as is
                    row.push(1);
                }
            } else {
                row.push(0);
            }
            continue;
        }

        // 4. 아래쪽 마을
        if (r >= 27 && r <= 37) {
            if (Math.random() < 0.2 && c % 2 === 0) row.push(1);
            else if (r % 4 === 0 && c % 4 === 0) row.push(1);
            else row.push(0);
            continue;
        }

        row.push(0);
    }
    tempZombieMap.push(row);
}

// --- 백룸 맵 생성 (60x60) ---
// 컨셉: "Liminal Space" - 반복적이고 단조롭지만 어딘가 불안한 공간
const B_COLS = 60;
const B_ROWS = 60;
const backroomsMap = [];

for (let r = 0; r < B_ROWS; r++) {
    const row = new Array(B_COLS).fill(0);
    backroomsMap.push(row);
}

// 1. 테두리 벽
for (let r = 0; r < B_ROWS; r++) {
    for (let c = 0; c < B_COLS; c++) {
        if (r === 0 || r === B_ROWS - 1 || c === 0 || c === B_COLS - 1) {
            backroomsMap[r][c] = 1;
        }
    }
}

// 2. 랜덤 기둥 (Pillars) - 규칙적인 듯 불규칙하게
for (let r = 2; r < B_ROWS - 2; r += 2) {
    for (let c = 2; c < B_COLS - 2; c += 2) {
        // 15% 확률로 기둥 생성 (너무 꽉 막히지 않게)
        if (Math.random() < 0.15) {
            backroomsMap[r][c] = 1;
            // 5% 확률로 2x2 기둥 (조금 더 큰 구조물)
            if (Math.random() < 0.5) backroomsMap[r][c + 1] = 1;
        }
    }
}

// 3. 긴 벽 (Walls) - 공간을 뚝뚝 끊어놓는 느낌
for (let i = 0; i < 40; i++) { // 40개의 벽 생성
    let len = Math.floor(Math.random() * 8) + 4; // 길이 4~11
    let r = Math.floor(Math.random() * (B_ROWS - 10)) + 5;
    let c = Math.floor(Math.random() * (B_COLS - 10)) + 5;
    let isVertical = Math.random() < 0.5;

    for (let j = 0; j < len; j++) {
        if (r >= 0 && r < B_ROWS && c >= 0 && c < B_COLS) { // Ensure coordinates are within bounds
            backroomsMap[r][c] = 1;
        }
        if (isVertical) r++; else c++;
    }
}


MAPS.TEMP_ZOMBIE = tempZombieMap; // 이름 변경
MAPS.BACKROOMS = backroomsMap;    // 신규 추가

module.exports = {
    TILE_SIZE,
    ROWS,
    COLS,
    BOT_PERSONALITIES,
    ITEM_TYPES,
    MAPS
};
